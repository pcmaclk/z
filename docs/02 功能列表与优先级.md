# 功能列表与优先级（冻结版·最终修订）

> 产品定位再次确认：  
> **轻量 · 精致 · 大文件友好 · 单文件发布 · 非专业代码编辑器**

---

## P0 — 核心生存功能（MVP 必须完成）

> 没有这些，就不叫“编辑器”

### 1️⃣ 文件基础操作（必须）

* 新建文件
* 打开单文件
* 保存
* 另存为
* 退出（未保存提示）

📌 说明

* 单窗口、单文件
* 文件 IO 同步即可（除大文件）
* **P0阶段编码策略**：仅保证 UTF-8 系列（无BOM/有BOM）的读写正确性。打开其他编码文件时，或提示不支持，或以 UTF-8 解读（可能乱码）。

---

### 2️⃣ 基础文本编辑（必须）

* 输入 / 删除
* 回退 / 删除行
* 回车 / Tab
* 复制 / 剪切 / 粘贴
* 全选
* 撤销 / 重做（≥ 50 步）

📌 说明

* 完整 IME 支持
* 不限制输入法
* 不做花哨输入规则

---

### 3️⃣ 光标 / 选区（必须）

* 单光标
* 流式选区（Stream Selection）
* **矩形选区（列选择）**（基础实现）
* Shift 扩展选区
* 鼠标选择

📌 不做

* ❌ 多光标

---

### 4️⃣ 视图与滚动（必须）

* 垂直滚动
* 自动滚动保证光标可见
* 行号显示
* 当前行高亮

📌 说明

* 完全基于 viewport
* 不一次性渲染全文

---

### 5️⃣ 编码与行尾（基础）

* UTF-8（无 BOM）
* UTF-8 with BOM
* 显示当前编码
* CRLF / LF 识别

📌 不做

* ❌ 自动转码写入（P1+）

---

### 6️⃣ 外观（精致但克制）

* 内置 **2 套主题**
  * Light
  * Dark
* 字体选择（等宽）
* 字体大小调整

📌 不做

* ❌ 自定义主题
* ❌ 外置主题文件

---

## P1 — 完整“日用编辑器”体验

> 这些决定“你会不会一直用它”

---

### 7️⃣ 查找（必须好用）

* 查找对话框
* 查找下一个 / 上一个
* 区分大小写
* 高亮匹配项

📌 不做

* ❌ 正则（P2）
* ❌ 替换（P2）

---

### 8️⃣ 状态栏信息

* 行 / 列
* 编码
* 行尾
* 文件修改状态

---

### 9️⃣ 基础配置

* 最近文件列表（≤ 5）
* 窗口位置 / 大小记忆
* 字体 / 主题记忆

📌 存储

* 单配置文件
* 不做复杂 schema

---

### 🔟 大文件支持（关键）

* > 10MB 文件打开无卡顿
* 分段读取
* 只渲染可见区域
* 编辑时不卡 UI

📌 分级策略

* 10MB ~ 50MB：性能监控模式
* > 50MB：自动启用“大文件模式”（减少后台任务）
* > 200MB：可进一步降级（关闭非核心功能）

---

### 1️⃣1️⃣ 文件修改状态感知

* 标题栏显示 `[*]` 标识
* 关闭/退出时的未保存提示
* 状态栏明确显示“已修改”状态

---

### 1️⃣2️⃣ 基础拖放支持

* 从资源管理器拖放文件到窗口 → 打开该文件
* 从编辑器内选择文本 → 可拖出到其他应用

---

### 1️⃣3️⃣ 列编辑（基础）

* **矩形选区删除**（Alt+鼠标 或 快捷键进入列模式，删除选中列块）
* **列选择可视化**（高亮显示矩形选区）

📌 说明

* 初期仅实现**列删除**，作为`Delete`操作的特殊模式
* 列插入/替换等完整编辑功能在P2实现
* 基于事务模型，一个列操作 = 多个独立行操作的集合

---

## P2 — 编辑效率增强（克制）

> 提升效率，但不引入复杂系统  
> **所有工具默认仅对选中区域生效**

---

### 1️⃣4️⃣ 多标签页（低优先）

* 多文件打开
* 标签关闭
* 标签切换

📌 限制

* 不支持拖拽排序（初期）
* 一个 tab = 一个 editor 实例

---

### 1️⃣5️⃣ 简单语法高亮（分级策略）

* 支持语言：Plain text, C/C++, Python, Markdown, JSON/XML, Shell
* **分级策略**：
  * ≤10MB：全文件分析 + 缓存
  * 10MB~50MB：仅分析视口内行（±50行缓冲区）
  * >50MB：仅分析当前视口内的行（无缓存，低优先级）
  * >200MB：提供手动开关，用户可选择关闭

📌 实现

* 自定义 lexer（正则+状态机）
* 非语义准确，不用 tree-sitter
* 分析任务异步且可中断

---

### 1️⃣6️⃣ 简单代码折叠

* 基于缩进 / `{}` / begin-end
* 行级折叠
* 折叠标记显示

📌 不做

* ❌ AST 折叠

---

### 1️⃣7️⃣ 查找替换（基础）

* 替换当前
* 替换全部
* 全字匹配

---

### 1️⃣8️⃣ 跳转

* 跳转行号
* 文件头 / 文件尾

---

### 1️⃣9️⃣ 列编辑（完整）

* **列插入**（在矩形选区每行相同位置插入相同字符）
* **列替换**（替换矩形选区内内容）
* **列粘贴**（将剪贴板内容按列粘贴到矩形选区）

📌 说明

* 完整列编辑作为独立事务类型实现
* 支持撤销/重做

---

### 2️⃣0️⃣ 文本转换工具（选区限定）

* 大小写转换（大写、小写、首字母大写）
* 编码转换（选区内容在 UTF-8/GBK 等格式间转换）
* 行尾转换（选区内容 CRLF ↔ LF）

---

### 2️⃣1️⃣ 行整理工具（选区限定）

* **删除空白行**（删除选中区域内所有空白行）
* **合并空白行**（将连续2个以上空白行合并为1个）
* **删除尾随空白**（可选择：仅选区/全文）
* **批量添加/删除行前缀**（用于快速注释/取消注释代码块）

---

### 2️⃣2️⃣ 行操作工具（选区限定）

* **行排序**（升序/降序，仅对选中行排序）
* **去重行**（移除选中区域内的重复行，可选保留第一个或去重连续重复）
* **行编号管理**（为选中行添加/移除行号，智能检测常见编号格式）

---

### 2️⃣3️⃣ 格式化工具（选区限定）

* JSON/XML 格式化（重新缩进与格式化，选区需包含完整结构）

---

## P3 — 可选但要非常谨慎

> 只在“核心非常稳定”后考虑

---

### 2️⃣4️⃣ 文本工具增强（精选）

* **行对齐**（按指定字符如 `=`、`:` 对齐选中行）
* **简单计算器**（计算选中数学表达式，仅支持四则运算）
* **Markdown表格格式化**（整理对齐Markdown表格）
* **时间戳转换**（UNIX时间戳 ↔ 可读时间）

📌 原则

* 必须是 **线性可预测操作**
* 必须保持 **选区限定** 安全约束

---

### 2️⃣5️⃣ 列编辑增强

* **列对齐**（将矩形选区内容按指定方式对齐）
* **数字序列填充**（在列选区中填充递增/递减数字序列）

---

### 2️⃣6️⃣ 编码扩展（可选）

* UTF-16 LE / BE
* GBK

📌 风险

* 会增加 IO / 转码复杂度
* 仅在核心架构稳定后考虑

---

### 2️⃣7️⃣ 国际化完善

* 内置中文 / 英文
* 编译期嵌入
* 不依赖外部语言包

---

## 明确不在范围内（再次冻结）

* ❌ 插件系统
* ❌ LSP（语言服务器协议）
* ❌ tree-sitter 或任何复杂语法分析器
* ❌ 多光标
* ❌ 侧边栏 / 文件树
* ❌ 动画效果
* ❌ Web 技术栈
* ❌ 版本控制集成
* ❌ 拼写检查
* ❌ 自动完成
* ❌ 宏录制

---

# 开发顺序建议（最终版）

### Phase 1（验证架构）
* **P0 全部**（含基础列选择）
* **P1 的 7、8、10**（查找、状态栏、大文件基础支持）
* **P1 的 13**（基础列编辑：列选择+删除）
* **目标**：产出“能长期使用的记事本替代品”核心，验证 Piece Table + 事务模型 + Slint 的完整数据流。

### Phase 2（日用编辑器）
* **P1 剩余**（配置、文件状态感知、拖放）
* **P2 的 14、15、17、19、20、21、22**（标签页、语法高亮、查找替换、完整列编辑、基础文本工具）
* **目标**：成为功能完整的轻量级编辑器，满足日常所有文本编辑需求。

### Phase 3（效率增强）
* **P2 剩余**（代码折叠、跳转、格式化等）
* **P3 的 24、25**（文本工具增强、列编辑增强）
* **目标**：在稳定基础上增加提升效率的“锦上添花”功能。

---

## 关键调整说明

1.  **列编辑分级实现**：
    - **P0**：基础列选择（可视化）
    - **P1**：列删除（作为基础编辑的自然扩展）
    - **P2**：完整列编辑（插入、替换、粘贴）
    - **P3**：列编辑增强（对齐、序列填充）

2.  **架构一致性**：
    - 列编辑完全基于现有事务模型，不引入新的状态管理复杂度
    - 矩形选区作为`Selection`的一种模式，与流式选区共享大部分逻辑

3.  **用户体验渐进**：
    - 用户从P0就能使用列选择（即使只能查看）
    - P1提供最常用的列删除功能
    - P2提供完整的列编辑能力
    - 每个阶段都是可用的完整产品

---

## 最终设计原则总结

1.  **克制胜过丰富**：每个功能必须与“轻量、大文件友好、单文件分发”的核心定位强绑定。
2.  **安全先于强大**：所有编辑工具默认仅对**选中区域**生效，避免全文件操作的性能风险。
3.  **渐进式体验**：功能根据文件大小和场景自动降级（如语法高亮），永远优先保证响应速度。
4.  **架构纯净**：绝不为了“看似有用”的功能引入复杂依赖或污染核心编辑模型。
5.  **务实的功能演进**：列编辑作为实用功能分阶段实现，既满足需求，又不破坏架构简洁性。

---

**这份列表已最终冻结。**  
接下来的工作应严格按此边界执行，优先保障 Phase 1 的架构验证与核心体验的坚固性。