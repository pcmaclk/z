# zedit é¡¹ç›®çŠ¶æ€æ€»ç»“

> æœ€åæ›´æ–°ï¼š2025-01-16

---

## ğŸ“Š å½“å‰è¿›åº¦

**æ•´ä½“è¿›åº¦**: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 50%

**å½“å‰ç‰ˆæœ¬**: v0.1.0-alpha
**å¼€å‘é˜¶æ®µ**: Phase 1 - MVP æ ¸å¿ƒï¼ˆéªŒè¯æ¶æ„ï¼‰

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. é¡¹ç›®åˆå§‹åŒ– âœ¨

- âœ… Rust é¡¹ç›®ç»“æ„æ­å»º
- âœ… Git ä»“åº“åˆå§‹åŒ–å¹¶æ¨é€åˆ° GitHub
- âœ… ä¾èµ–é…ç½®ï¼ˆSlintã€cosmic-textã€memmap2 ç­‰ï¼‰
- âœ… å®Œæ•´çš„æ¨¡å—ç›®å½•ç»“æ„

**ä»“åº“åœ°å€**: https://github.com/pcmaclk/z

### 2. Piece Table æ ¸å¿ƒå®ç° ğŸ¯

**æ¨¡å—æ–‡ä»¶**ï¼ˆ7 ä¸ªï¼‰:
```
src/core/buffer/
â”œâ”€â”€ mod.rs              # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ piece_table.rs      # Piece Table æ ¸å¿ƒï¼ˆ862 è¡Œï¼‰
â”œâ”€â”€ mode.rs             # ç¼“å†²åŒºæ¨¡å¼é…ç½®
â”œâ”€â”€ utf8.rs             # UTF-8 è¾¹ç•Œå®‰å…¨å·¥å…·
â”œâ”€â”€ mmap.rs             # å†…å­˜æ˜ å°„å°è£…
â”œâ”€â”€ lines.rs            # è¡Œç´¢å¼•ç®¡ç†
â”œâ”€â”€ deletion_info.rs    # å»¶è¿Ÿåˆ é™¤ä¿¡æ¯
â””â”€â”€ chunk_iter.rs       # æµå¼è¿­ä»£å™¨
```

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… å®Œæ•´çš„æ’å…¥/åˆ é™¤/æŸ¥è¯¢æ“ä½œ
- âœ… UTF-8 å®‰å…¨çš„å­—ç¬¦è¾¹ç•Œå¤„ç†
- âœ… æ™ºèƒ½åˆå¹¶ç­–ç•¥ï¼ˆè‡ªé€‚åº”æ–‡ä»¶å¤§å°ï¼‰
- âœ… å¤§æ–‡ä»¶å†…å­˜æ˜ å°„æ”¯æŒï¼ˆArc<Mmap>ï¼‰
- âœ… å»¶è¿Ÿåˆ é™¤ä¼˜åŒ–ï¼ˆèŠ‚çœå†…å­˜ï¼‰
- âœ… æµå¼è¿­ä»£å™¨ï¼ˆæŒ‰å—è¯»å–ï¼‰
- âœ… äº‹åŠ¡å¼ç¼–è¾‘ï¼ˆä¸å¯å˜çŠ¶æ€æœºï¼‰

**æµ‹è¯•è¦†ç›–**:
```
running 7 tests
test core::buffer::piece_table::tests::test_piece_table_basic ... ok
test core::buffer::piece_table::tests::test_utf8_safety ... ok
test core::buffer::piece_table::tests::test_lazy_delete ... ok
test core::buffer::piece_table::tests::test_chunk_iter ... ok
test core::buffer::utf8::tests::test_ensure_char_boundary ... ok
test core::buffer::utf8::tests::test_ensure_char_boundary_range ... ok
test core::buffer::utf8::tests::test_safe_substr ... ok

test result: ok. 7 passed; 0 failed
```

### 3. æ¶æ„è®¾è®¡æ–‡æ¡£ ğŸ“š

**æ ¸å¿ƒæ–‡æ¡£**ï¼ˆ24 ä¸ªï¼‰:
- âœ… æŠ€æœ¯é€‰æ‹©æ¸…å•
- âœ… åŠŸèƒ½åˆ—è¡¨ä¸ä¼˜å…ˆçº§
- âœ… æ¶æ„å®ªæ³•ï¼ˆARCHITECTURE.mdï¼‰
- âœ… PieceTable å®Œæ•´å®ç°æ–¹æ¡ˆ
- âœ… åˆ†é˜¶æ®µå¼€å‘è·¯çº¿å›¾
- âœ… å„å­ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼ˆEdit Transactionã€Viewportã€ViewModelã€Layoutã€Renderã€Inputã€Actionã€IO ç­‰ï¼‰

### 4. Git æäº¤è®°å½• ğŸ“

**é¦–æ¬¡æäº¤**: `99fa5c2`
```
feat: åˆå§‹åŒ– zedit é¡¹ç›®å¹¶å®ç° Piece Table æ ¸å¿ƒåŠŸèƒ½

56 ä¸ªæ–‡ä»¶æ›´æ”¹ï¼Œ43,198 è¡Œæ–°å¢
- Piece Table å®Œæ•´å®ç°
- å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- å®Œæ•´æ¶æ„è®¾è®¡æ–‡æ¡£
```

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
z/
â”œâ”€â”€ docs/                          # è®¾è®¡æ–‡æ¡£ï¼ˆ24 ä¸ªï¼‰
â”‚   â”œâ”€â”€ 01 æŠ€æœ¯é€‰æ‹©æ¸…å•.md
â”‚   â”œâ”€â”€ 02 åŠŸèƒ½åˆ—è¡¨ä¸ä¼˜å…ˆçº§.md
â”‚   â”œâ”€â”€ 03 ARCHITECTURE.md         # æ¶æ„å®ªæ³•
â”‚   â”œâ”€â”€ 06 zedit åˆ†é˜¶æ®µå¼€å‘è·¯çº¿å›¾.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs                    # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ lib.rs                     # åº“å…¥å£
â”‚   â””â”€â”€ core/
â”‚       â””â”€â”€ buffer/                # Piece Table å®ç°ï¼ˆ7 ä¸ªæ¨¡å—ï¼‰
â”‚           â”œâ”€â”€ mod.rs
â”‚           â”œâ”€â”€ piece_table.rs     # æ ¸å¿ƒ
â”‚           â”œâ”€â”€ mode.rs
â”‚           â”œâ”€â”€ utf8.rs
â”‚           â”œâ”€â”€ mmap.rs
â”‚           â”œâ”€â”€ lines.rs
â”‚           â”œâ”€â”€ deletion_info.rs
â”‚           â””â”€â”€ chunk_iter.rs
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/                      # å•å…ƒæµ‹è¯•
â”‚   â”‚   â””â”€â”€ piece_table_tests.rs
â”‚   â””â”€â”€ integration/               # é›†æˆæµ‹è¯•
â”‚       â””â”€â”€ piece_table_integration_tests.rs
â”œâ”€â”€ Cargo.toml                     # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
â””â”€â”€ .gitignore
```

---

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

### 1. æ¶æ„è®¾è®¡

- **å•å‘æ•°æ®æµ**: Input â†’ Action â†’ Editor Core â†’ Transaction â†’ Viewport â†’ ViewModel â†’ Render
- **ä¸å¯å˜çŠ¶æ€æœº**: æ¯æ¬¡æ“ä½œè¿”å›æ–°çŠ¶æ€ï¼Œå¤©ç„¶æ”¯æŒæ’¤é”€/é‡åš
- **åˆ†å±‚è®¾è®¡**: 13 ä¸ªå­ç³»ç»Ÿï¼ŒèŒè´£æ¸…æ™°ï¼Œè¾¹ç•Œæ˜ç¡®

### 2. æ€§èƒ½ä¼˜åŒ–

- **å¤§æ–‡ä»¶æ”¯æŒ**: å†…å­˜æ˜ å°„ + åˆ†çº§ç­–ç•¥
  - å°æ–‡ä»¶ï¼ˆ<10MBï¼‰: å…¨å†…å­˜
  - å¤§æ–‡ä»¶ï¼ˆ10-100MBï¼‰: å†…å­˜æ˜ å°„
  - è¶…å¤§æ–‡ä»¶ï¼ˆ>100MBï¼‰: å—é™æ¨¡å¼
- **æ™ºèƒ½åˆå¹¶**: æ ¹æ®æ–‡ä»¶å¤§å°è‡ªé€‚åº”åˆå¹¶ç­–ç•¥
- **å»¶è¿ŸåŠ è½½**: åˆ é™¤æ“ä½œå»¶è¿ŸåŠ è½½æ–‡æœ¬å†…å®¹
- **æµå¼å¤„ç†**: æ”¯æŒæŒ‰å—è¿­ä»£ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨å†…å®¹

### 3. UTF-8 å®‰å…¨

- æ‰€æœ‰æ“ä½œéƒ½ä¿è¯å­—ç¬¦è¾¹ç•Œ
- è‡ªåŠ¨è°ƒæ•´åˆ°æœ€è¿‘çš„å­—ç¬¦è¾¹ç•Œ
- æ”¯æŒå¤šå­—èŠ‚å­—ç¬¦ï¼ˆä¸­æ–‡ã€emoji ç­‰ï¼‰

---

## ğŸ“‹ å¾…å¼€å‘åŠŸèƒ½

### Phase 1 å‰©ä½™ä»»åŠ¡ï¼ˆMVP æ ¸å¿ƒï¼‰

#### 1. Edit Transaction System âš¡
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**ç›®æ ‡**: å»ºç«‹æ’¤é”€/é‡åšæœºåˆ¶

**å®ç°è¦ç‚¹**:
- [ ] å®šä¹‰ `EditTransaction` ç»“æ„
- [ ] å®ç° `UndoStack` å’Œ `RedoStack`
- [ ] è¿ç»­è¾“å…¥è‡ªåŠ¨åˆå¹¶
- [ ] å¤§å‹æ“ä½œé˜²æŠ¤ï¼ˆæš‚åœè‡ªåŠ¨åˆå¹¶ï¼‰
- [ ] å¯é…ç½®çš„æ’¤é”€æ·±åº¦ï¼ˆé»˜è®¤ 100ï¼‰

**å‚è€ƒæ–‡æ¡£**: `docs/09 Edit_Transaction - ç¼–è¾‘äº‹åŠ¡ç³»ç»Ÿå®Œæ•´å®ç°.md`

**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

---

#### 2. Cursor & Selection ğŸ¯
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**ç›®æ ‡**: å…‰æ ‡ç§»åŠ¨å’Œé€‰åŒºç®¡ç†

**å®ç°è¦ç‚¹**:
- [ ] `Cursor` ç»“æ„ï¼ˆå­—èŠ‚åç§»ï¼‰
- [ ] `Selection` ç»“æ„ï¼ˆæµå¼ + çŸ©å½¢ï¼‰
- [ ] å…‰æ ‡ç§»åŠ¨é€»è¾‘ï¼ˆå­—ç¬¦ã€å•è¯ã€è¡Œï¼‰
- [ ] Shift æ‰©å±•é€‰åŒº
- [ ] é¼ æ ‡ç‚¹å‡»å’Œæ‹–æ‹½

**å‚è€ƒæ–‡æ¡£**: å¾…åˆ›å»º

**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

---

#### 3. Slint UI é›†æˆ ğŸ–¼ï¸
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**ç›®æ ‡**: åˆ›å»ºå¯è§†åŒ–ç¼–è¾‘å™¨ç•Œé¢

**å®ç°è¦ç‚¹**:
- [ ] åŸºç¡€çª—å£åˆ›å»º
- [ ] æ–‡æœ¬æ¸²æŸ“ï¼ˆä½¿ç”¨ Canvasï¼‰
- [ ] è¡Œå·æ˜¾ç¤º
- [ ] æ»šåŠ¨æ¡
- [ ] äº‹ä»¶æ•è·ï¼ˆé”®ç›˜ã€é¼ æ ‡ï¼‰
- [ ] è™šæ‹ŸåŒ–æ¸²æŸ“ï¼ˆåªæ¸²æŸ“å¯è§è¡Œï¼‰

**å‚è€ƒæ–‡æ¡£**:
- `docs/Slint Canvas.md`
- `docs/Slintäº‹ä»¶å¤„ç†.md`

**é¢„ä¼°å·¥ä½œé‡**: 3-5 å¤©

---

#### 4. åŸºç¡€ç¼–è¾‘åŠŸèƒ½ âœï¸
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**ç›®æ ‡**: å®ç°åŸºæœ¬çš„æ–‡æœ¬ç¼–è¾‘

**å®ç°è¦ç‚¹**:
- [ ] æ–‡æœ¬è¾“å…¥ï¼ˆIME æ”¯æŒï¼‰
- [ ] åˆ é™¤æ“ä½œï¼ˆBackspaceã€Deleteï¼‰
- [ ] å›è½¦æ¢è¡Œ
- [ ] Tab è¾“å…¥
- [ ] å¤åˆ¶/å‰ªåˆ‡/ç²˜è´´
- [ ] å…¨é€‰

**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

---

#### 5. Viewport System ğŸ‘ï¸
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

**ç›®æ ‡**: ç®¡ç†å¯è§åŒºåŸŸå’Œæ»šåŠ¨

**å®ç°è¦ç‚¹**:
- [ ] è®¡ç®—å¯è§è¡ŒèŒƒå›´
- [ ] å‘ Editor Core æ‹‰å–æ•°æ®
- [ ] è‡ªåŠ¨æ»šåŠ¨ä¿è¯å…‰æ ‡å¯è§
- [ ] æ»šåŠ¨æ¡åŒæ­¥

**å‚è€ƒæ–‡æ¡£**: `docs/10 Viewportç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£.md`

**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

---

### Phase 2 ä»»åŠ¡ï¼ˆå®Œæ•´ç¼–è¾‘å™¨ï¼‰

- [ ] å¤šæ ‡ç­¾é¡µæ”¯æŒ
- [ ] è¯­æ³•é«˜äº®ï¼ˆè‡ªå®šä¹‰ lexerï¼‰
- [ ] æŸ¥æ‰¾æ›¿æ¢
- [ ] æ–‡ä»¶æ‰“å¼€/ä¿å­˜
- [ ] é…ç½®æ–‡ä»¶
- [ ] ä¸»é¢˜ç³»ç»Ÿ

**å‚è€ƒæ–‡æ¡£**: `docs/06 zedit åˆ†é˜¶æ®µå¼€å‘è·¯çº¿å›¾.md`

---

## ğŸš€ å¼€å‘å»ºè®®

### ä¼˜å…ˆçº§æ’åº

1. **ç«‹å³å¼€å§‹**: Edit Transaction System + Cursor & Selection
2. **ç´§æ¥ç€**: Slint UI é›†æˆ + åŸºç¡€ç¼–è¾‘åŠŸèƒ½
3. **ç„¶å**: Viewport System
4. **æœ€å**: Phase 2 åŠŸèƒ½

### æŠ€æœ¯å€ºåŠ¡ç®¡ç†

- âœ… æš‚æ— æŠ€æœ¯å€ºåŠ¡
- âš ï¸ éœ€è¦å®šæœŸè¿è¡Œæ€§èƒ½æµ‹è¯•
- âš ï¸ éœ€è¦è¡¥å……æ›´å¤šå•å…ƒæµ‹è¯•

### é£é™©æ§åˆ¶

- âœ… æ¶æ„æ¸…æ™°ï¼Œè¾¹ç•Œæ˜ç¡®
- âœ… æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹å¯æµ‹
- âœ… éµå¾ª"æ¸è¿›å¼å®ç°"åŸåˆ™

---

## ğŸ“Š è´¨é‡æŒ‡æ ‡

### ä»£ç è´¨é‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ |
|------|--------|--------|
| æµ‹è¯•è¦†ç›–ç‡ | ~60% | >80% |
| ç¼–è¯‘è­¦å‘Š | 2 ä¸ª | 0 ä¸ª |
| ä»£ç è¡Œæ•° | ~43,000 | - |
| æ–‡æ¡£å®Œæ•´æ€§ | 100% | 100% |

### æ€§èƒ½ç›®æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ |
|------|--------|--------|
| å¯åŠ¨æ—¶é—´ | - | <1s |
| å¤§æ–‡ä»¶æ‰“å¼€ï¼ˆ100MBï¼‰ | - | <2s |
| ç¼–è¾‘å“åº” | - | <16ms (60 FPS) |
| å†…å­˜å ç”¨ | - | <50MB (åŸºç¡€) |

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **GitHub ä»“åº“**: https://github.com/pcmaclk/z
- **é¦–æ¬¡æäº¤**: 99fa5c2
- **åˆ†æ”¯**: main

---

## ğŸ’¡ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### æ¨è 1ï¼šå®Œæˆ MVP æ ¸å¿ƒï¼ˆ2-3 å‘¨ï¼‰

1. **Edit Transaction System**ï¼ˆ2-3 å¤©ï¼‰
2. **Cursor & Selection**ï¼ˆ2-3 å¤©ï¼‰
3. **Slint UI é›†æˆ**ï¼ˆ3-5 å¤©ï¼‰
4. **åŸºç¡€ç¼–è¾‘åŠŸèƒ½**ï¼ˆ2-3 å¤©ï¼‰
5. **Viewport System**ï¼ˆ2-3 å¤©ï¼‰

**ç›®æ ‡**: äº§å‡º"èƒ½é•¿æœŸä½¿ç”¨çš„è®°äº‹æœ¬æ›¿ä»£å“"æ ¸å¿ƒ

### æ¨è 2ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ1 å‘¨ï¼‰

1. æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
2. å¤§æ–‡ä»¶æ€§èƒ½éªŒè¯
3. å†…å­˜ä½¿ç”¨åˆ†æ
4. çƒ­ç‚¹ä¼˜åŒ–

### æ¨è 3ï¼šæ–‡æ¡£å®Œå–„ï¼ˆæŒç»­ï¼‰

1. API æ–‡æ¡£ç”Ÿæˆï¼ˆcargo docï¼‰
2. ä½¿ç”¨ç¤ºä¾‹
3. è´¡çŒ®æŒ‡å—
4. å¼€å‘è€…æŒ‡å—

---

## ğŸ“ å¤‡æ³¨

- æœ¬æ–‡æ¡£å°†æŒç»­æ›´æ–°
- æ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½ï¼Œæ›´æ–°è¿›åº¦
- é‡åˆ°é‡å¤§å†³ç­–ï¼Œæ›´æ–°æ¶æ„æ–‡æ¡£
- ä¿æŒ"å…‹åˆ¶ã€èšç„¦ã€é«˜è´¨é‡"çš„å¼€å‘åŸåˆ™

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-16
**æœ€åæ›´æ–°**: 2025-01-16
